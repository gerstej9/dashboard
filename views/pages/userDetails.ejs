<!DOCTYPE html>
<html>
  <head>
    <title>Numerai Dashboard</title>
    <link href= "/style/reset.css" rel= "stylesheet">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet">
    <link href= "/style/base.css" rel= "stylesheet">
    <link id = "theme" href= "../style/<%=theme%>layout.css" rel= "stylesheet"> 
    <link href= "/style/modules.css" rel= "stylesheet">
    <link href= "/style/userdetailmodal.css" rel= "stylesheet">
  </head>
  <body>
    <header>
      <h1>NMRai Dashboard</h1>
      <h2>Daily Performance</h2>
      <h2>Date: <%=date%></h2>
      <h2>Live Rounds: <%=userData[0].activeRounds[0].roundNumber%> to <%=userData[0].activeRounds[3].roundNumber%></h2>
      <h2>NMR Price: <%=nmrPrice%></h2>
      <label class="switch">
        <input class = "toggle" type="checkbox" <%if(theme === 'dark'){%>checked<%}%>>
        <span class="slider round"></span>
      </label>
      <h3>Dark Mode</h3>
      <nav>
        <a href = "/">Home</a>
      </nav>
    </header>
    <main>
      <h2 class ="user"><%=username%></h2>
      <form id = "modelComparisonPage" action = "" method = "GET">
        <button id = "comparisonRoundButton">View Comparison by Round</button>
      </form>
      <div class = "titleRow monkey">
        <p>Model</p>
        <p>Staked</p>
        <p>Payout</p>
        <p>Daily Change</p>
        <p>Prev Corr Rank</p>
        <p>Rank</p>
        <p>MMC Rank</p>
      </div>
      <% let userTotalStake = 0%>
      <%let activeTotalAllModels = 0%>
      <%let dailyChangeAllModels = 0%>
      <%for(let i = 0; i< userData.length; i++){%>
      <div class = "modelRow monkey">
        <p class = "collectionModelNames"><%=userData[i].modelName%></p>
        <p><%=userData[i].totalStake%> NMR</p>
        <% userTotalStake+=Number(userData[i].totalStake)%>
        <% let activeTotal = 0%>
        <%for(let j =0; j< userData[i].activeRounds.length; j++){activeTotal+= Number(userData[i].activeRounds[j].payoutPending)}%>
        <%if(isNaN(activeTotal) === true){activeTotal = 0}%>
        <p><%=activeTotal.toFixed(2)%> NMR </p>
        <p><%=userData[i].dailyChange%> NMR </p>
        <%dailyChangeAllModels += Number(userData[i].dailyChange)%>
        <p><%=userData[i].corrPrev%></p>
        <p><%=userData[i].corrCurrent%></p>
        <p><%=userData[i].mmcCurrent%></p>
      </div>
      <div class="modal myModal <%=userData[i].modelName%>">

        <!-- Modal content -->
        <div class="modal-content">
          <span class="close">&times;</span>
          <h2><%=userData[i].modelName%></h2>
          <div class = "modalTitleRow">
            <p>Round</p>
            <p>Corr</p>
            <p>MMC</p>
            <p>Stake</p>
            <p>Payout</p>
          </div>
          <div class = "modalTitleRow">
            <p><%=userData[i].activeRounds[3].roundNumber%></p>
            <p><%=userData[i].activeRounds[3].correlation.toFixed(3)%></p>
            <p><%=userData[i].activeRounds[3].mmc.toFixed(3)%></p>
            <% let stake = Number(userData[i].activeRounds[3].selectedStakeValue)%>
            <p><%=stake.toFixed(2)%></p>
            <% let payout = Number(userData[i].activeRounds[3].payoutPending)%>
            <p><%=payout.toFixed(2)%></p>
          </div>
          <div class = "modalTitleRow">
            <p><%=userData[i].activeRounds[2].roundNumber%></p>
            <p><%=userData[i].activeRounds[2].correlation.toFixed(3)%></p>
            <p><%=userData[i].activeRounds[2].mmc.toFixed(3)%></p>
            <% stake = Number(userData[i].activeRounds[2].selectedStakeValue)%>
            <p><%=stake.toFixed(2)%></p>
            <% payout = Number(userData[i].activeRounds[2].payoutPending)%>
            <p><%=payout.toFixed(2)%></p>
          </div>
          <div class = "modalTitleRow">
            <p><%=userData[i].activeRounds[1].roundNumber%></p>
            <p><%=userData[i].activeRounds[1].correlation.toFixed(3)%></p>
            <p><%=userData[i].activeRounds[1].mmc.toFixed(3)%></p>
            <% stake = Number(userData[i].activeRounds[1].selectedStakeValue)%>
            <p><%=stake.toFixed(2)%></p>
            <% payout = Number(userData[i].activeRounds[1].payoutPending)%>
            <p><%=payout.toFixed(2)%></p>
          </div>
          <div class = "modalTitleRow">
            <p><%=userData[i].activeRounds[0].roundNumber%></p>
            <p><%=userData[i].activeRounds[0].correlation.toFixed(3)%></p>
            <p><%=userData[i].activeRounds[0].mmc.toFixed(3)%></p>
            <% stake = Number(userData[i].activeRounds[0].selectedStakeValue)%>
            <p><%=stake.toFixed(2)%></p>
            <% payout = Number(userData[i].activeRounds[0].payoutPending)%>
            <p><%=payout.toFixed(2)%></p>
          </div>
        </div>
      
      </div>
      <%activeTotalAllModels+= Number(activeTotal)}%>
      <div class = "totalRow monkey">
        <p>Daily Change NMR: <%=dailyChangeAllModels.toFixed(2)%> NMR</p>
        <% let dailyChangeAllModelsUsd = (dailyChangeAllModels *nmrPrice)%>
        <p>Daily Change USD: $<%=dailyChangeAllModelsUsd.toFixed(2)%></p>
        <p>Total Pending Payout: <%=activeTotalAllModels.toFixed(2)%> NMR </p>
        <%let currPayoutUsd = (activeTotalAllModels*nmrPrice).toFixed(2)%>
        <p>Total Pending USD: $<%=currPayoutUsd%></p>
        <p>Total NMR Staked: <%= userTotalStake.toFixed(2)%> NMR</p>
        <%let stakedPayoutUsd = (userTotalStake*nmrPrice).toFixed(2)%>
        <p>Total USD Staked: $<%=stakedPayoutUsd%></p>
        <% let userLiveTotal = (userTotalStake + activeTotalAllModels).toFixed(2)%>
        <p>Live Total NMR: <%=userLiveTotal%> NMR</p>
        <% let userLiveTotalUsd = (userLiveTotal*nmrPrice).toFixed(2)%>
        <p> Live Total USD: $<%=Number(userLiveTotalUsd).toFixed(2)%></p>
      </div>
      <div>
        <p class = "modelFound" id = "<%=modelFound%>"> Model Does Not Exist</p>
        <form action ="/<%=username%>/addmodel?_method=PUT" method = "POST">
          <label>Add Model</label>
          <input class ="model-input" type="text" name ="model"></input>
          <input type = "submit"></input>
        </form>
        <form action="/<%=username%>/removemodel?_method=PUT" method="POST">
          <label>Remove Model</label>
          <select name = "model">
            <option value = "default">Choose Model</option>
            <%for(let i = 0; i< userData.length; i++){%>
              <option value = "<%=userData[i].modelName%>"><%=userData[i].modelName%></option>
              <%}%>
          </select>
          <input type = "submit"></input>
        </form>
      </div>
    </main>
    <footer>

    </footer>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src= '/js/model.js'></script>
    <script src= '/js/darkmode.js'></script>
  </body>
</html>